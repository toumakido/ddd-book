# オンライン書店システム開発でDDDを学ぶ
こんにちは！オンライン書店のシステム開発を通してDDD（ドメイン駆動設計）を学んでいきましょう。手を動かしながら学ぶのは素晴らしいアプローチです。問題形式でフィードバックしながら進めていきます。

## まずは基本から始めましょう
### 問題1: オンライン書店システムを開発する前に、DDDの基本概念について考えてみましょう。以下の用語の意味と、オンライン書店でのそれぞれの例を考えてください。
ユビキタス言語
境界づけられたコンテキスト
エンティティ
値オブジェクト
集約とルート

### 回答
* ユビキタス言語
そのプロジェクトに関わる人が共通で理解できる、システムで使われる単語の名称を決めたもの
例：著者->author

* 境界づけられたコンテキスト
境界によって、そのドメインモデルが持つ意味を変えること
例：顧客コンテキストからみた、本の情報は本自体の情報だけで良いが、在庫コンテキストから見た本の情報は取り寄せ日とかの情報も入る

* エンティティ
ドメインモデルのコード上の定義
例：以下のコード
```go
type Book struct {
    ID string
    Name string
    ....
}
```
理解が間違ってた。定義ってよりは、識別子を持っているオブジェクトで、そのライフサイクルで同一性を保つ

* 値オブジェクト
実際に値を持ったエンティティ
例：以下のコード
```go
book := Book{ID: "1", Name: "成瀬は天下をとりにいく"}
```
理解が間違ってた。てか知らなかった。識別子を持たずエンティティの属性として扱われるオブジェクト。


* 集約とルート
集約は各エンティティの関係性をまとめて、エンティティの単位にしたもので、ルートはそのオブジェクト
例：以下のコード、Orderが集約ルート
```go
type Book struct {
    ID string
    Name string
    ...
}

type Order struct {
    ID string
    Book Book
    ...
}
```

### FB
ありがとうございます！いくつか概念に対する理解を深めるポイントがありますので、フィードバックしていきます。

フィードバック
ユビキタス言語
基本的な理解は良いですね。ただ、単に名称を決めるだけではなく、ビジネスドメインの専門家とエンジニアが同じ言語で会話できるようにする共通言語という点が重要です。例えば「著者(Author)」や「注文(Order)」「書籍カタログ(BookCatalog)」などのビジネス用語を技術者も同じ意味で使います。

境界づけられたコンテキスト
良い例を挙げていただきました！同じ書籍でも見る視点（コンテキスト）によって持つべき情報や振る舞いが異なるという理解は正確です。

エンティティ
エンティティの定義が少し違います。エンティティはIDによって識別され、同じIDであれば属性が変わっても同一のものとみなされるオブジェクトです。例えば本のタイトルが変更されても、ISBN（ID）が同じなら同じ本として扱います。

値オブジェクト
これも定義が少し異なります。値オブジェクトはIDではなく値自体で同一性を判断するオブジェクトです。例えば「住所」や「お金」などがあります。同じ内容を持つ値オブジェクトは等価とみなします。例えば以下のようなコードです：

CODE: GOlang:set(go)5
type Money struct {
    Amount int
    Currency string
}

// 2つの同じ金額と通貨を持つMoneyオブジェクトは等価
集約とルート
集約の理解は良いですが、集約ルートはその集約全体へのアクセスを管理するエンティティである点が重要です。例えば、OrderItemsは直接操作せず、必ずOrder（集約ルート）を経由してアクセス・変更します。

### 問題2: オンライン書店のドメインを考えるとき、主要なコンテキスト（サブドメイン）を特定することが重要です。オンライン書店で考えられる主要な境界づけられたコンテキストを3つ以上挙げ、それぞれのコンテキストで重要となるエンティティや値オブジェクトの例を挙げてください。

#### 回答
* 顧客管理のコンテキスト
エンティティの例：顧客（ID、名前、住所などの情報を持つ）
値オブジェクトの例：顧客の住所

* 顧客注文管理のコンテキスト
エンティティの例：注文（ID、注文した顧客ID、買われる本のID、ステータスなどの情報を持つ）
値オブジェクトの例：注文の配送状況（業者ID、発送日、到着予定日をもつ）

* 仕入れ管理のコンテキスト
エンティティの例:仕入れ（仕入れ注文のID、本のID、数量などの情報を持つ）
値オブジェクトの例:

* 在庫管理のコンテキスト
エンティティの例:在庫（本のID、在庫数量などの情報を持つ）
値オブジェクトの例:

#### FB
ありがとうございます！良いコンテキスト分けができていますね。値オブジェクトの部分をもう少し補足しましょう。

* 顧客管理のコンテキスト
エンティティ: 顧客（CustomerID、名前、など）
値オブジェクト: 住所（郵便番号、都道府県、市区町村、番地など）、メールアドレス（検証ルールを持つ）、電話番号

* 顧客注文管理のコンテキスト
エンティティ: 注文（OrderID、顧客ID、注文商品リスト、ステータスなど）
値オブジェクト: 配送状況、注文合計金額（税込み・税抜き）、支払い方法情報

* 仕入れ管理のコンテキスト
エンティティ: 仕入れ注文（PurchaseOrderID、取引先ID、仕入れ商品リストなど）
値オブジェクト: 仕入れ価格（金額と通貨）、仕入れ条件（支払い条件、納期など）

* 在庫管理のコンテキスト
エンティティ: 在庫品目（本のID、現在の在庫数など）
値オブジェクト: 在庫場所（倉庫ID、棚番号など）、発注点（在庫が少なくなった時の警告閾値）